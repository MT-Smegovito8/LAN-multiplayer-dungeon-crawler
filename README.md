version without networking and probably cleaner code
